import numpy as np
from downstream_fairness.utils.barycenter import transport


def test_transport_monotonocity():
    """
    Test to make sure that given a source distribution, a destination distribution, bins, and two scores x1 < x2
    that the transport function, transport(), obeys transport(x1) < transport(x2)
    """
    src_dist = [0.14, 0.18, 0.21, 0.23, 0.25, 0.27, 0.29, 0.3, 0.32, 0.33, 0.34, 0.35, 0.36, 0.37,
                0.38, 0.39, 0.4, 0.41, 0.42, 0.43, 0.43, 0.44, 0.45, 0.46, 0.46, 0.47, 0.48, 0.48,
                0.49, 0.5, 0.5, 0.51, 0.52, 0.52, 0.53, 0.53, 0.54, 0.55, 0.55, 0.56, 0.56, 0.57,
                0.58, 0.58, 0.59, 0.6, 0.6, 0.61, 0.61, 0.62, 0.63, 0.63, 0.64, 0.65, 0.65, 0.66,
                0.66, 0.67, 0.68, 0.68, 0.69, 0.7, 0.7, 0.71, 0.72, 0.72, 0.73, 0.74, 0.74, 0.75,
                0.76, 0.77, 0.77, 0.78, 0.79, 0.79, 0.8, 0.81, 0.82, 0.82, 0.83, 0.84, 0.85, 0.85,
                0.86, 0.87, 0.88, 0.89, 0.9, 0.9, 0.91, 0.92, 0.93, 0.94, 0.95, 0.96, 0.97, 0.98,
                0.99, 1.0, 1.0]

    dst_dist = [0.13784071, 0.17942212, 0.20528771, 0.23123516, 0.25251698, 0.27052468,
                0.28640419, 0.30130147, 0.31701727, 0.32986822, 0.34353769, 0.35303266,
                0.36432839, 0.37300483, 0.38356389, 0.39445036, 0.40288123, 0.41155767,
                0.41826962, 0.42514529, 0.43234837, 0.43971515, 0.44642711, 0.45584022,
                0.46271589, 0.47016452, 0.47687648, 0.48399771, 0.48858148, 0.49545715,
                0.50225096, 0.50961775, 0.51510191, 0.52205943, 0.52811656, 0.53343701,
                0.54064009, 0.54587869, 0.55291806, 0.55791111, 0.56478677, 0.5720717,
                0.57690104, 0.58410412, 0.59040681, 0.59744618, 0.60235737, 0.60882377,
                0.61463534, 0.6213473, 0.62740444, 0.63346157, 0.64000982, 0.6458214,
                0.65187853, 0.65777196, 0.66358353, 0.6706229, 0.67717115, 0.68314644,
                0.68944913, 0.69583367, 0.70287305, 0.70983056, 0.71777032, 0.72415487,
                0.73103053, 0.73741508, 0.74494557, 0.75263976, 0.75951543, 0.76761889,
                0.7744127, 0.78030613, 0.78693624, 0.79422117, 0.80183351, 0.80870918,
                0.81509372, 0.82156012, 0.82802652, 0.83842187, 0.84619792, 0.85471065,
                0.86256855, 0.87239093, 0.87959401, 0.8883523, 0.89661946, 0.90431366,
                0.91307195, 0.9234673, 0.93157076, 0.9402472, 0.94998772, 0.96013751,
                0.96848654, 0.97781779, 0.98723091, 0.99541622, 1.0]

    bins = np.linspace(0, 1, 101)

    x1 = 0.1
    x2 = 0.11
    x3 = 0.5

    transport1 = transport(x1, src_dist, dst_dist, bins)
    transport2 = transport(x2, src_dist, dst_dist, bins)
    transport3 = transport(x3, src_dist, dst_dist, bins)

    assert transport1 <= transport2
    assert transport1 <= transport3
    assert transport2 <= transport3
